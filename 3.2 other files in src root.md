# **SRC Folder Documentation - Core Files**

## **ðŸ“‹ Table of Contents**

### **[1. Overview](#1-overview)**
- [1.1 What is SRC Folder?](#11-what-is-src-folder)
- [1.2 Key Architecture](#12-key-architecture)

### **[2. Critical Files](#2-critical-files)**
- [2.1 `index.tsx` - React Entry Point](#21-indextsx---react-entry-point)
- [2.2 `App.tsx` - Main Component](#22-apptsx---main-component)
- [2.3 `Head.tsx` - SEO Management](#23-headtsx---seo-management)
- [2.4 `nreum.js` - Performance Monitoring](#24-nreumjs---performance-monitoring)
- [2.5 `global.d.ts` - TypeScript Declarations](#25-globaldts---typescript-declarations)
- [2.6 `DuplicateTabHandler.tsx` - Session Control](#26-duplicatetabhandlertsx---session-control)

---

## **1. Overview**

### **1.1 What is SRC Folder?**
**Location**: `/src/`  
**Purpose**: Contains ALL application code - React components, logic, styles, everything  
**Type**: TypeScript + React single-page application

### **1.2 Key Architecture**
```
public/index.html (HTML skeleton)
        â†“
    <div id="root">
        â†“
src/index.tsx (React mounts here)
        â†“
    Providers wrap App
        â†“
src/App.tsx (Only this changes on navigation)
```

**[â¬† Back to Top](#table-of-contents)**

---

## **2. Critical Files**

### **2.1 `index.tsx` - React Entry Point**
**File**: `/src/index.tsx`  
**Purpose**: Bootstrap the entire React application

```typescript
const root = ReactDOM.createRoot(
  document.getElementById('root') as HTMLElement
);

root.render(
  <Provider store={store}>
    <PersistGate loading={null} persistor={persistor}>
      <BrowserRouter>
        <StrictMode>
          <DuplicateTabHandler>
            <App />
          </DuplicateTabHandler>
        </StrictMode>
      </BrowserRouter>
    </PersistGate>
  </Provider>
);
```

**What Happens**:
1. Finds `#root` div from HTML
2. Mounts React app inside it
3. Wraps with all providers
4. **Only `<App />` content changes** on navigation
5. Providers stay mounted (no re-render)

### **2.2 `App.tsx` - Main Component**
**File**: `/src/App.tsx`  
**Purpose**: Defines app layout and routing

**SPA Concept**:
- **Single HTML file** (`public/index.html`)
- **No page reloads** when navigating
- **Content updates** inside `#root` only
- **Layout stays**, content changes

### **2.3 `Head.tsx` - SEO Management**
**File**: `/src/Head.tsx`  
**Purpose**: Manages meta tags for SEO and responsiveness

```tsx
/**
 * Head Component
 * Manages document head metadata and stylesheet loading
 * Uses react-helmet for SEO
 */
function Head() {
  return (
    <Helmet onChangeClientState={loadStyleSheets}>
      {/* Viewport for mobile */}
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      
      {/* SEO Tags */}
      <title>ETchat Web</title>
      <meta name="description" content="Secure messaging app" />
      <meta name="keywords" content="chat, messaging, video call" />
      
      {/* Open Graph (Facebook) */}
      <meta property="og:title" content="ETchat Web" />
      <meta property="og:description" content="Stay connected..." />
      <meta property="og:image" content="/media/logo.svg" />
      
      {/* Twitter Cards */}
      <meta name="twitter:card" content="summary_large_image" />
      
      {/* Favicons */}
      <link rel="icon" href="/media/logo-light.svg" />
      <link rel="manifest" href="/manifest.json" />
      
      {/* Structured Data for Google */}
      <script type="application/ld+json">
        {`{
          "@context": "https://schema.org",
          "@type": "WebApplication",
          "name": "ETchat Web"
        }`}
      </script>
    </Helmet>
  );
}
```

**Key Meta Tags**:
| Tag | Purpose |
|-----|---------|
| `viewport` | Makes app responsive on mobile |
| `description` | SEO - shown in search results |
| `keywords` | SEO - helps search ranking |
| `og:` | Social media sharing (Facebook) |
| `twitter:` | Twitter card display |
| `manifest` | PWA installation |

### **2.4 `nreum.js` - Performance Monitoring**
**File**: `/src/nreum.js`  
**Purpose**: New Relic performance monitoring

**What is New Relic?**:
- **Observability platform** - monitors app performance
- **Tells you**: What's slow, what's broken, where to fix
- **Provides**: Real-time analytics, error tracking, performance data

**Why We Need It**:
1. **Monitor performance** in production
2. **Track errors** and bottlenecks
3. **Understand user experience**
4. **Debug production issues**

**Typical Setup**:
```javascript
// nreum.js content (simplified)
window.NREUM = window.NREUM || {};
NREUM.info = {
  beacon: "bam.nr-data.net",
  licenseKey: "YOUR_LICENSE_KEY",
  applicationID: "YOUR_APP_ID"
};
// Loads New Relic agent for monitoring
```

### **2.5 `global.d.ts` - TypeScript Declarations**
**File**: `/src/global.d.ts`  
**Purpose**: Defines global types for TypeScript

**Problem**: Some JavaScript packages don't have TypeScript types  
**Solution**: We declare them globally here

**Example**:
```typescript
// Declare module for JS package without TS types
declare module 'some-js-package' {
  export function someFunction(): void;
  export const someConstant: string;
}

// Global window extensions
interface Window {
  _converse: any;  // Converse.js instance
  NREUM: any;      // New Relic
  someGlobal: any; // Other globals
}
```

**Why Needed**:
1. **No TS types available** for some packages
2. **Prevent TypeScript errors** when using JS libs
3. **Define our own interfaces**
4. **Extend global objects** (like `window`)

### **2.6 `DuplicateTabHandler.tsx` - Session Control**
**File**: `/src/DuplicateTabHandler.tsx`  
**Purpose**: Prevents multiple tabs of the app

**Problem**: Multiple tabs cause issues:
- XMPP connection conflicts
- State synchronization problems
- Resource duplication
- User confusion

**Solution**: Detect if app already open in another tab

**How It Works**:
```typescript
const DuplicateTabHandler = ({ children }) => {
  useEffect(() => {
    const channel = new BroadcastChannel('app-tabs');
    
    // Send "I'm here" message
    channel.postMessage('new-tab');
    
    // Listen for other tabs
    channel.onmessage = (event) => {
      if (event.data === 'tab-exists') {
        // Another tab is already open
        alert('You already have this application open in another tab. Please close this tab and use the existing one to prevent issues.');
        window.close(); // Close this tab
      }
    };
    
    return () => channel.close();
  }, []);
  
  return <>{children}</>;
};
```

**User Experience**:
1. User opens app in Tab 1 âœ…
2. User tries to open app in Tab 2 ðŸš«
3. Shows warning: "You already have this application open in another tab..."
4. Suggests closing Tab 2
5. Only one active session per browser

**Limitations**:
- Only works within same browser
- Different browsers can each have one tab
- User can ignore warning (but issues may occur)

**[â¬† Back to Top](#table-of-contents)**

---

## **Summary**

| File | Purpose | Why Important |
|------|---------|---------------|
| `index.tsx` | React entry point | Bootstraps entire app |
| `App.tsx` | Main component | Handles routing & layout |
| `Head.tsx` | SEO & meta tags | Search ranking & social sharing |
| `nreum.js` | Performance monitoring | Production debugging |
| `global.d.ts` | TypeScript types | Prevents TS errors |
| `DuplicateTabHandler.tsx` | Session control | Prevents multi-tab issues |

**Key Architecture Points**:
1. **SPA**: One HTML file, dynamic updates
2. **Providers**: Wrap once, stay mounted
3. **SEO**: Managed via `Head.tsx`
4. **Monitoring**: New Relic for production
5. **Type Safety**: `global.d.ts` for missing types
6. **Session Control**: One tab per browser

